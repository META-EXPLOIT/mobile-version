package br.com.metaexploit.diversight.ui

import android.content.Context
import android.os.Bundle
import androidx.fragment.app.Fragment
import android.view.View
import androidx.appcompat.widget.AppCompatImageView
import androidx.appcompat.widget.AppCompatTextView
import androidx.core.content.res.ResourcesCompat
import androidx.navigation.fragment.NavHostFragment
import androidx.navigation.fragment.findNavController
import br.com.metaexploit.diversight.R

class OnBoardingFragment : Fragment(R.layout.fragment_on_boarding) {

    private lateinit var skipButton: AppCompatTextView
    private lateinit var backButton: AppCompatTextView
    private lateinit var nextButton: AppCompatTextView

    private lateinit var dot1: AppCompatImageView
    private lateinit var dot2: AppCompatImageView
    private lateinit var dot3: AppCompatImageView

    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
        super.onViewCreated(view, savedInstanceState)

        activity?.window?.statusBarColor =
                    ResourcesCompat.getColor(resources, R.color.white, null)

        skipButton = view.findViewById(R.id.fg_on_boarding_text_button_skip)
        backButton = view.findViewById(R.id.fg_on_boarding_text_button_back)
        nextButton = view.findViewById(R.id.fg_on_boarding_text_button_next)

        dot1 = view.findViewById(R.id.fg_on_boarding_dot_1)
        dot2 = view.findViewById(R.id.fg_on_boarding_dot_2)
        dot3 = view.findViewById(R.id.fg_on_boarding_dot_3)

        val nav =
            (childFragmentManager.findFragmentById(R.id.fg_on_boarding_fg_container) as NavHostFragment).navController

        var currentScreen = 1

        nextButton.setOnClickListener {
            when (currentScreen) {
                1 -> {
                    nav.navigate(R.id.onBoardingPart2Fragment)
                    backButton.visibility = View.VISIBLE

                    dot1.setBackgroundResource(R.drawable.ic_on_boarding_dot_off)
                    dot2.setBackgroundResource(R.drawable.ic_on_boarding_dot_on)
                    dot3.setBackgroundResource(R.drawable.ic_on_boarding_dot_off)

                    currentScreen += 1
                }
                2 -> {
                    nav.navigate(R.id.onBoardingPart3Fragment)

                    dot1.setBackgroundResource(R.drawable.ic_on_boarding_dot_off)
                    dot2.setBackgroundResource(R.drawable.ic_on_boarding_dot_off)
                    dot3.setBackgroundResource(R.drawable.ic_on_boarding_dot_on)

                    nextButton.text = "Vamos lá!"

                    currentScreen += 1
                }
                3 -> {
                    setSharedPreferences()
                    navigateToLogin()
                }
            }
        }

        backButton.setOnClickListener {
            if (currentScreen == 2) {
                nav.navigate(R.id.onBoardingPart1Fragment)
                backButton.visibility = View.INVISIBLE

                dot1.setBackgroundResource(R.drawable.ic_on_boarding_dot_on)
                dot2.setBackgroundResource(R.drawable.ic_on_boarding_dot_off)
                dot3.setBackgroundResource(R.drawable.ic_on_boarding_dot_off)

                currentScreen -= 1
            } else if (currentScreen == 3) {
                nextButton.text = "Próximo!"

                nav.navigate(R.id.onBoardingPart2Fragment)
                dot1.setBackgroundResource(R.drawable.ic_on_boarding_dot_off)
                dot2.setBackgroundResource(R.drawable.ic_on_boarding_dot_on)
                dot3.setBackgroundResource(R.drawable.ic_on_boarding_dot_off)
                currentScreen -= 1

            }
        }

        skipButton.setOnClickListener {
            setSharedPreferences()
            navigateToLogin()
        }
    }

    private fun navigateToLogin() {
        findNavController().navigate(
            OnBoardingFragmentDirections.actionOnBoardingFragmentToLoginFragment()
        )
    }

    private fun setSharedPreferences() {
        val sharedPref = activity?.getPreferences(Context.MODE_PRIVATE) ?: return
        with (sharedPref.edit()) {
            putBoolean(getString(R.string.key_boarding_visible), true)
            commit()
        }
    }
}


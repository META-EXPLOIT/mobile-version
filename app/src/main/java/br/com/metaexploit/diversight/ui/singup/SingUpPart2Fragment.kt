package br.com.metaexploit.diversight.ui.singup

import android.os.Bundle
import android.view.View
import android.widget.ArrayAdapter
import android.widget.AutoCompleteTextView
import android.widget.ImageView
import androidx.fragment.app.Fragment
import androidx.navigation.fragment.findNavController
import androidx.navigation.fragment.navArgs
import br.com.metaexploit.diversight.R
import com.google.android.material.button.MaterialButton
import com.google.android.material.textfield.TextInputLayout

class SingUpPart2Fragment : Fragment(R.layout.fragment_sing_up_part2) {

    private val args: SingUpPart2FragmentArgs by navArgs()

    private lateinit var backButton: ImageView

    private lateinit var inputEnterprise: TextInputLayout
    private lateinit var autoCompleteEnterprise: AutoCompleteTextView
    private var selectedEnterprise: String = ""
    private val listEnterprise = listOf(
        "Ioasys",
        "Havaianas",
        "Minuzo"
    )

    private lateinit var inputOccupation: TextInputLayout
    private lateinit var autoCompleteOccupation: AutoCompleteTextView
    private var selectedOccupation: String = ""
    private val listOccupation = listOf(
        "Administrativo",
        "Atendimento ao cliente",
        "Comercial",
        "Data Science",
        "Desenvolvimento",
        "Financeiro",
        "Infraestrutura e Segurança de T.I.",
        "Inteligência de dados e Projetos",
        "Jurídico",
        "Localização e Tradução",
        "Marketing",
        "Produtos",
        "Recursos Humanos",
        "Riscos e compliance"
    )

    private lateinit var inputOffice: TextInputLayout
    private lateinit var autoCompleteOffice: AutoCompleteTextView
    private var selectedOffice: String = ""
    private val listOffice = listOf(
        "Estágio",
        "Assistente",
        "Trainee",
        "Analista",
        "Gerente",
        "Coordenação",
        "Direção"
    )

    private lateinit var nextButton: MaterialButton

    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
        super.onViewCreated(view, savedInstanceState)

        // Back button
        backButton = view.findViewById(R.id.fg_sing_up_2_button_back)
        backButton.setOnClickListener {
            findNavController().popBackStack()
        }

        // Enterprise
        inputEnterprise = view.findViewById(R.id.fg_sing_up_2_edt_enterprise)
        autoCompleteEnterprise = view.findViewById(R.id.fg_sing_up_2_edt_enterprise_autocomplete)
        setAdapter(inputEnterprise, listEnterprise)
        autoCompleteEnterprise.setOnItemClickListener { _, _, position, _ ->
            selectedEnterprise = listEnterprise[position].lowercase()
        }

        // Occupation
        inputOccupation = view.findViewById(R.id.fg_sing_up_2_edt_occupation)
        autoCompleteOccupation = view.findViewById(R.id.fg_sing_up_2_edt_occupation_autocomplete)
        setAdapter(inputOccupation, listOccupation)
        autoCompleteOccupation.setOnItemClickListener { _, _, position, _ ->
            selectedOccupation = listOccupation[position].lowercase()
        }

        // Office
        inputOffice = view.findViewById(R.id.fg_sing_up_2_edt_office)
        autoCompleteOffice = view.findViewById(R.id.fg_sing_up_2_edt_office_autocomplete)
        setAdapter(inputOffice, listOffice)
        autoCompleteOffice.setOnItemClickListener { _, _, position, _ ->
            selectedOffice = listOffice[position].lowercase()
        }

        // Next button
        nextButton = view.findViewById(R.id.fg_sing_up_2_btn_next)
        nextButton.setOnClickListener {
            nextPart()
        }
    }

    private fun nextPart() {
        findNavController().navigate(
            SingUpPart2FragmentDirections.actionSingUpPart2FragmentToSingUpPart3Fragment(
                args.name,
                args.skin,
                args.sex,
                args.gender,
                args.pcd,
                args.pcdVisual,
                args.pcdFisical,
                args.pcdHearing,
                args.pcdIntellectual,
                args.pcdPsychosocial,
                args.pcdReadapted,
                args.birthday,
                selectedEnterprise,
                selectedOccupation,
                selectedOffice
            )
        )
    }

    private fun setAdapter(inputLayout: TextInputLayout, items: List<String>) {
        val adapter = ArrayAdapter(requireContext(), R.layout.list_item, items)
        (inputLayout.editText as? AutoCompleteTextView)?.setAdapter(adapter)
    }

//    override fun onPause() {
//        super.onPause()
//
//        val context = activity?.applicationContext
//
//        CoroutineScope(Dispatchers.IO).launch {
//            val db = context?.let {
//                Room.databaseBuilder(
//                    it,
//                    AppDatabase::class.java, "database"
//                ).build()
//            }
//
//            val user = db?.userDao()?.getRegisterUser(2)?.get(0)
//            db?.userDao()?.updateUser(
//                User(
//                    2,
//                    user?.name,
//                    user?.skin,
//                    user?.sex,
//                    user?.gender,
//                    user?.pcd,
//                    user?.pcdVisual,
//                    user?.pcdFisical,
//                    user?.pcdHearing,
//                    user?.pcdIntellectual,
//                    user?.pcdPsychosocial,
//                    user?.pcdReadapted,
//                    user?.birthday,
//                    selectedEnterprise,
//                    selectedOccupation,
//                    selectedOffice,
//                    null,
//                    null
//                )
//            )
//
//            Log.i("TESTE", "${db?.userDao()?.getRegisterUser(2)?.get(0)}")
//        }
//    }
}